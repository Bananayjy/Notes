# 2024-06-18

## 1、关于排序问题

```java
 @Override
    public MsgListVo info(MsgInfoDto msgInfoDto) {
        // 当前登录人信息
        PigxUser user = SecurityUtils.getUser();

        // 声明出参
        MsgListVo msgListVo = new MsgListVo();

        // 消息
        List<Messages> messages = new ArrayList<>();

        if(Objects.isNull(msgInfoDto.getMessageId())) {
            // id为null，获取最新的100条数据
            messages = messagesMapper.selectList(Wrappers.<Messages>lambdaQuery()
                    .orderByDesc(Messages::getCreateTime)
                    .eq(Messages::getCommunicationRequestId, msgInfoDto.getCommunicationRequestId())
                    .last("LIMIT " + loadMsgNum.toString()).orderByAsc(Messages::getSendTime));
        } else {
            // id不为null，获取id大于此id的100条数据
            messages = messagesMapper.selectList(Wrappers.<Messages>lambdaQuery()
                    .orderByDesc(Messages::getCreateTime)
                    .le(Messages::getId, msgInfoDto.getMessageId())
                    .eq(Messages::getCommunicationRequestId, msgInfoDto.getCommunicationRequestId())
                    .last("LIMIT " + loadMsgNum.toString()).orderByAsc(Messages::getSendTime));
        }

        msgListVo.setCount(messages.size());

        msgListVo.setMsgInfoVoList(messages.stream().map(r -> {
            MsgListVo.MsgInfoVo msgInfoVo = new MsgListVo.MsgInfoVo();
            BeanUtils.copyProperties(r, msgInfoVo);
            return msgInfoVo;
        }).sorted(Comparator.comparing(r -> r.getSendTime())).collect(Collectors.toList()));


        // todo 未读消息的更新，提到外面，前端去进行异步调用
        /*messagesMapper.update(Wrappers.<Messages>lambdaUpdate()
                .eq(Messages::getCommunicationRequestId, msgInfoDto.getCommunicationRequestId())
                .set(Messages::getUnreadUserIds, Messages.readOp( )));*/


        return msgListVo;
    }

```

