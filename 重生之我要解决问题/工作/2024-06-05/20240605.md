# 20240605

## 1、脚本文件

从公司的`monitor_and_start.sh`文件入手。

### 1.1 .sh文件

`.sh`文件是一种Shell脚本文件，通常用于Unix和类Unix系统中，如Linux和macOS。Shell脚本是一系列用来执行特定任务的命令的文本文件。这些命令按照顺序执行，可以包含各种系统命令、控制结构、变量定义等。

`.sh`文件中的命令通常是Shell命令，如`echo`、`grep`、`awk`等，用来执行文件操作、文本处理、系统管理等任务。这些脚本文件可以用来自动化重复性的任务，简化系统管理和日常操作。

在Unix和类Unix系统中，`.sh`文件通常使用Bourne shell（sh）或其变种，如Bash（Bourne Again Shell）、Korn shell（ksh）等作为解释器来执行其中的命令。因此，`.sh`文件也被称为Shell脚本文件。

例如，一个简单的Shell脚本文件可能如下所示：

```
#!/bin/bash

# 这是一个注释
echo "Hello, world!"

```

这个脚本文件首先指定了解释器为Bash（#!/bin/bash），然后使用`echo`命令输出"Hello, world!"。



### 1.2 monitor_and_start.sh

```shell
#!/bin/bash

# 定义jar文件名数组
jar_files=("pigx-upms-biz-sso.jar" "hs-ward.jar" "pigx-gateway.jar" "pigx-auth.jar")

#jar包存放路径
jar_dir="/nfdata/hs"

# Java可执行文件的绝对路径
java_exec="/nfdata/engine/jdk1.8.0_301/bin/java"

# 定义日志文件路径
log_file="/app/monitor/logs/monitor.log"

# 遍历每个jar文件
for jar_file in "${jar_files[@]}"; do
    # 检查jar进程是否存在
    if pgrep -f "$jar_file" >/dev/null; then
        echo "$(date): Jar进程 '$jar_file' 已经在运行." >> "$log_file"
    else
        echo "$(date): Jar进程 '$jar_file' 不存在，启动中..." >> "$log_file"
        
        # 启动jar进程的命令，你可能需要根据实际情况修改
        #java -jar "$jar_file" &
				nohup "$java_exec" -Xms512m -Xmx1024m -Djava.security.egd=file:/dev/./urandom -jar "$jar_dir"/"$jar_file" > "$jar_dir"/logs/"$jar_file".log 2>&1 &
       
        echo "$(date): Jar进程 '$jar_file' 已启动." >> "$log_file"
    fi
done

```

