## 一、

```
 @Value("${pic.compress.target:100}")
    public int targetSize = 100;

    public static int staticTargetSize = 100;

    @Value("${pic.compress.quality:0.4}")
    public double quality = 0.4;

    public static double staticQuality = 0.4; 
    //传递给静态变量
    @PostConstruct
    public void init() {
        staticTargetSize = targetSize;
        staticQuality = quality;
        log.info("【图片压缩】 | 压缩目标大小={}kb | 压缩质量比={}", staticTargetSize, staticQuality);
    } 这么做的意义
```



## 二、输入输出流序列化失败问题

```
/**
	 * 批量获取文件流S3存储桶中的对象
	 * @param sysFileDto
	 * @return
	 */
	@Inner(false)
	@PostMapping("/batch")
	public R<List<byte[]>> getFileBatch(@RequestBody List<SysFileDto> sysFileDto){
		log.debug("调用附近批量查询接口，入参：{}", sysFileDto);
		return R.ok(sysFileService.getFileBatch(sysFileDto));
	}
```



```
@Override
	public List<byte[]> getFileBatch(List<SysFileDto> sysFileDto) {
		List<byte[]> ret = new ArrayList<>();
		if(CollectionUtil.isNotEmpty(sysFileDto)){
			sysFileDto.stream().forEach(r -> {
				S3Object s3Object = fileTemplate.getObject(r.getBucket(), r.getFileName());
				ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
				byte[] buffer = new byte[1024];
				int bytesRead = 0;
				while (true) {
					try {
						if (!((bytesRead = s3Object.getObjectContent().read(buffer)) != -1)) break;
					} catch (IOException e) {
						e.printStackTrace();
					}
					outputStream.write(buffer, 0, bytesRead);
				}
				byte[] data = outputStream.toByteArray();
				ret.add(data);
			});
		}
		return ret;
	}
```



## 三、文件该后缀

原：

```
String originalUrl = medRecordAttachment.getOriginalImageUrl();
                String preUrl = originalUrl.substring(0, originalUrl.lastIndexOf("/") + 1);
                String thumbUrl = preUrl + ThumbnailPrefix + originalUrl.substring(originalUrl.lastIndexOf("/") + 2); 请您帮我优化一下代码
```

现：

```
java
import java.nio.file.Paths;

// 假设ThumbnailPrefix为缩略图的前缀，比如"thumb_"
String originalUrl = medRecordAttachment.getOriginalImageUrl();
String filename = Paths.get(originalUrl).getFileName().toString();
String thumbUrl = Paths.get(originalUrl).getParent().toString() + "/" + ThumbnailPrefix + filename;
```



```
import java.io.File;

String originalUrl = medRecordAttachment.getOriginalImageUrl();
String preUrl = originalUrl.substring(0, originalUrl.lastIndexOf(File.separatorChar) + 1);
String thumbUrl = preUrl + ThumbnailPrefix + originalUrl.substring(originalUrl.lastIndexOf(File.separatorChar) + 2);
```

