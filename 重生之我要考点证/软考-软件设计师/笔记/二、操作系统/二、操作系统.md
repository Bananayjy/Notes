## 二、操作系统

### 1、进程管理

#### 1.1 操作系统概述

**操作系统定义：**

能有效地组织和管理系统中的各种软/硬件资源，合理地组织计算机系统工作流程，控制程序的执行，并且向用户提供一个良好的工作环境和友好的接口。（PC上：Windows、Linux等移动端上：安卓、IOS等）

**操作系统两个重要作用：**

- 通过资源管理（软硬件管理，不止管理软件，也管理软件，操作系统属于系统软件，与系统软件相区分的是应用软件：如淘宝等）提供计算机系统的效率
- 改善人机界面向用户提供友好的工作环境（Dos、Linux一般采用命令行的方式）

**操作系统特征（4个）：**

- 并发性：对用户来说感觉是并行的（微观交替进行，并行是同一时刻一起执行），在操作系统中CPU是交替执行应用
- 共享性：操作系统中的资源是共享的
- 虚拟性：和设备管理有关，独占设备转换为共享资源
- 不确定性：异步性，同一个程序执行两边结果可能不一样

**操作系统功能：**

- 进程管理：实质上是对处理机（CPU）的执行“时间”进行管理，采用多道程序等技术将CPU的时间合理地分配给每个任务，主要包括进程控制、进程同步、进程通信和进程调度。
- 文件管理：主要包括文件存储空间管理、目录管理、文件的读/写管理和存取控制。
- 存储管理：存储管理是对主存储器（辅存管理就是文件管理）“空间”进行管理，主要包括存储分配与回收、存储保护、地址映射(变换)和主存扩充。
- 设备管理：实质是对硬件设备的管理，包括对输入/输出设备的分配、启(4)动、完成和回收。
- 作业管理：包括任务、界面管理、人机交互、图形界面、语音控制和虚拟现实等。

**操作系统分类：**

- 批处理操作系统: 不用人为操作，即一次处理100个，只需要设定一下程序，程序就会一个一个去处理。单道批处理（一个处理完才会处理下一个）和多道批处理(同时处理多个任务，主机与外设可并行)
- 分时操作系统:一个计算机系统与多个终端设备连接。将CPU的工作时间划分为许多很短的时间片，轮流（不能让一个长时间占用执行，否则其他就不能运行了）为各个终端的用户服务，感觉上，各个终端同时在使用该操作系统，对交互能力要求高。
- 实时操作系统:实时是指计算机对于外来信息能够以足够快的速度进行处理并在被控对象允许的时间范围内做出快速反应。实时系统对交互能力要求不高，但要求可靠性有保障。
- 网络操作系统:是使联网计算机能方便而有效地共享网络资源，为网络用户提供各种服务的软件和有关协议的集合。三种模式:集中模式（有个集中的计算器来共享）、客户端/服务器模式（即C/S）、对等模式（PPP，整个网络中计算机都是平等的，既可以作为客户端，也可以作为服务器）。
- 分布式操作系统：（网络操作系统的升级，区别就是网络操作系统中的各个计算机都处于一个网络中），分布式计算机系统是由多个分散的计算机经连接而成的计算机系统，系统中的计算机无主、次之分，任意两台计算机可以通过通信交换信息。
- 微型计算机操作系统:（我们生活中常用的）简称微机操作系统，常用的有Windows、Mac OS、Linux.

**嵌入式操作系统特点**

嵌入式操作系统：嵌入到智能设备中的系统。（通俗）

- 微型化。从性能和成本角度考虑，希望占用的资源和系统代码量少，如内存少、字长短、运行速度有限、能源少(用微小型电池)。（像PC端中Windows系统的话，就需要4GB左右大小，很大）
- 可定制。从减少成本和缩短研发周期考虑，要求嵌入式操作系统能运行在不同的微处理器平台上，能针对硬件变化（不同设备硬件不同，不像PC那么固定，只有CPU、内存……构成，如空调的话就需要制冷机等）进行结构与功能上的配置，以满足不同应用需要。
- 实时性。嵌入式操作系统主要应用于过程控制、数据采集、传输通信、多媒体信息及关键要害领域需要迅速响应的场合，所以对实时性要求较高。
- 可靠性。系统构件、模块和体系结构必须达到应有的可靠性，对关键要害应用还要提供容错和防故障措施。
- 易移植性。为了提高系统的易移植性，通常采用硬件抽象层和板级支撑包的底层设计技术

嵌入式系统初始化过程按照自底向上、从硬件到软件的次序依次为:片级初始化（芯片级别的初始化）→板级初始化（板上各种外设吃刷）→系统初始化（操作系统初始化）。个人PC的启动也是有启动顺序：硬件启动->BIOS(烧在主板上的固化程序)->系统初始化

#### 1.2 进程组成和状态

**进程组成：**

- 进程控制块PCB（process controller block唯一标志）
- 程序（描述进程要做什么）
- 数据（存放进程执行时所需数据）

**三态图：**进程三态之间转换如左图所示（右侧五态图不要求掌握）

![image-20250227230830476](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250227230830476.png)

- 运行态：需要CPU资源进行运行
- 就绪态：除了CPU，其他需要的资源都有了
- 阻塞：除了CPU，还缺其他条件（如外设需要传输数据，即IO操作，速度比较慢，需要把CPU让出去）

扩展：

- 新建：新建一个进程后，还没有分配到就绪队列中
- 终止：运行完了，还要释放一些资源



> 真题：AC
>
> ![image-20250303235018238](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250303235018238.png)



#### 1.3 前驱图

用来表示哪些任务可以并行执行，哪些任务之间有顺序关系，具体如下图:可知，ABC可以并行执行，但是必须ABC都执行完后，才能执行D，这就确定了两点:任务间的并行、任务间的先后顺序

![image-20250303235112828](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250303235112828.png)



#### 1.4 进程资源图

用来表示进程和资源之间的分配和请求关系，，如下图所示

![image-20250303235323848](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250303235323848.png)

- P代表进程，R代表资源，R方框中有几个圆球就表示有几个这种资源，在上图中，R1指向P1，表示R1有一个资源已经分配给了P1，P1指向R2，表示P1还需要请求一个R2资源才能执行，
- 阻塞节点:某进程所请求的资源已经全部分配完毕，无法获取所需资源，该进程被阻塞了无法继续。如上图中P2。
- 非阻塞节点:某进程所请求的资源还有剩余，可以分配给该进程继续运行。如上图中P1、P3。
- 当一个进程资源图中所有进程都是阻塞节点时，即陷入死锁状态



真题：CB

![image-20250304222352901](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250304222352901.png)![image-20250304222413820](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250304222413820.png)



#### 1.5 进程同步或互斥

一些概念：

- 临界资源:各进程间需要以互斥方式对其进行访问的资源。

- 临界区:指进程中对临界资源实施操作的那段程序。本质是一段程序代码。
- 互斥:某资源(即临界资源)在同一时间内只能由一个任务单独使用，使用时需要加锁，使用完后解锁才能被其他任务使用。如打印机。
- 同步:多个任务可以并发执行，只不过有速度上的差异，在一定情况下停下等待，不存在资源是否单独或共享的问题。如A—>B,可以选择自行车和汽车，但是汽车先到要等待自行车一起到了再去做后面的事情。
- 互斥信号量:对临界资源采用互斥访问，使用互斥信号量后其他进程无法访问，初值为1。
- 同步信号量:对共享资源的访问控制（有数量上限，需要控制），初值一般是共享资源的数量



对于信号量的操作：

S是信号量（包括互斥信号量和同步信号量），当S大于0表示资源的个数，当S小于0表示有多少个进程等待这个资源。

- P操作：申请资源，S = S - 1,若S>0,则执行P操作的进程继续执行；若S<0,则置该进程为阻塞状态（因为无可用资源），并将其插入阻塞队列。
- V操作：释放资源，S=S+1，若S>0，则执行V操作的进程继续执行:若S<=0，则从阻塞状态唤醒一个进程，并将其插入就绪队列(此时因为缺少资源被P操作阻塞的进程可以继续执行)，然后执行V操作的进程继续。

![image-20250304223622723](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250304223622723.png)





金典问题：

![image-20250304224632284](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250304224632284.png)

互斥信号量需要配套，一一对应，即 有P就要V

同步信号量没事



真题：

![image-20250304224610355](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250304224610355.png)



#### 1.6 进程调度

##### 1. 进程调度方式

进程调度方式是指当有更高优先级的进程到来时如何分配CPU资源。分为可剥夺和不可剥夺两种，可剥夺指当有更高优先级进程到来时，强行将正在运行进程的CPU分配给高优先级进程;不可剥夺是指高优先级进程必须等待当前进程自动释放CPU。

##### 2.三级调度

在某些操作系统中，一个作业从提交到完成需要经历高、中、低三级调度。

(1)高级调度。高级调度又称“长调度”、“作业调度”或“接纳调度”，它决定处于输入池中的哪个后备作业可以调入主系统做好运行的准备，成为一个或一组就绪进程。在系统中一个作业（一组进程，一组完整的程序）只需经过一次高级调度。

(2)中级调度。中级调度又称“中程调度”或“对换调度”，它决定处于交换区中的哪个就绪进程可以调入内存（放入就绪队列中），以便直接参与对CPU的竞争（还没有获取CPU）。

(3)低级调度。低级调度又称“短程调度”或“进程调度”它决定处于内存中的哪个就绪进程可以占用CPU。低级调度是操作系统中最活跃、最重要的调度程序，对系统的影响很大

##### 3.调度算法

通过调度算法，决定哪一个进程来使用CPU。属于低级调度中的算法。

- 先来先服务FCFS：先到达的进程优先分配CPU。用于宏观调度。
- 时间片轮转（分时系统）:分配给每个进程CPU时间片，轮流使用CPU，每个进程时间片大小相同，很公平，用于微观调度。
- 优先级调度:每个进程都拥有一个优先级，优先级大的先分配CPU。
- 多级反馈调度：时间片轮转和优先级调度结合而成，设置多个就绪队列1,2,3...n，每个队列分别赋予不同的优先级，分配不同的时间片长度:新进程先进入队列1的末尾，按FCFS原则，执行队列1的时间片;若未能执行完进程，则转入队列2的末尾，如此重复。（不同队列通过优先级排列，同一个队列通过时间片轮转获取CPU，不同优先级队列中的时间片设置大小不一样）

![image-20250324210052307](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324210052307.png)





#### 1.7 死锁

##### 1.概念

当一个进程在等待永远不可能发生的事件时，就会产生死锁，若系统中有多个进程处于死锁状态，就会造成系统死锁。

##### 2.死锁产生的四个必要条件

- 资源互斥
- 每个进程占有资源并等待其他资源
- 系统不能剥夺进程资源
- 进程资源图是一个环路（循环）

##### 3.解决死锁

死锁产生后解决措施是打破四大条件，有下列方法:

- 死锁预防：采用某种策略限制并发进程对于资源的请求，破坏死锁产生的四个条件之一使系统任何时刻都不满足死锁的条件。
- 死锁避免：一般采用银行家算法来避免，银行家算法，就是提前计算出一条不会死锁的资源分配方法，才分配资源，否则不分配资源，相当于借贷，考虑对方还得起才借钱，提前考虑好以后，就可以避免死锁。
- 死锁检测：允许死锁产生，但系统定时运行一个检测死锁的程序，若检测到系统中发生死锁，则设法加以解除。
- 死锁解除：即死锁发生后的解除方法，如强制剥夺资源，撤销进程等。
- 死锁资源计算：系统内有n个进程，每个进程都需要R个资源，那么其发生死锁的最大资源数为`n*(R-1)`(即n个进程，都持有r-1个资源，等待1个资源)。其不发生死锁的最小资源数为`n*(R-1)+1`（有任何一个进程获取R个资源，即可打破死锁）



##### 4.真题

![image-20250324211710321](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324211710321.png)

B

BD

![image-20250324212850898](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324212850898.png)

DB



#### 1.8 线程

传统的进程有两个属性:可拥有资源的独立单位（PCB)；可独立调度和分配的基本单位。

引入线程的原因是进程在创建、撤销和切换中，系统必须为之付出较大的时空开销，故在系统中设置的进程数目不宜过多，进程切换的频率不宜太高，这就限制了并发程度的提高。引入线程后，将传统进程的两个基本属性分开，线程作为调度和分配的基本单位，进程作为独立分配资源的单位。用户可以通过创建线程来完成任务，以减少程序并发执行时付出的时空开销。

线程是进程中的一个实体（不拥有资源，资源都是进程拥有的，线程共享进程的资源），是被系统独立分配和调度的基本单位（TCB）。上不拥有资源，只拥有一点运行中必不可少的资源(如程序计数器.、一组寄存器和栈)，它可与同属一个进程的其他线程共享进程所拥有的全部资源，例如进程的公共数据、全局变量、代码、文件等资源，但不能共享线程独有的资源如线程的栈指针等标识数据。



### 2、存储管理

#### 2.1 分区存储管理

所谓分区存储组织，就是整存然后再执行。有三种分区方式：

- 固定分区: 静态分区方法，将主存分为若干个固定的分区，将要运行的作业装配进去，由于分区固定，大小和作业需要的大小不同，会产生内部碎片。如将8GM的主存，分为若干分区，每个分区大小100MB，如果此时的程序运行需要内存大小是50MB，那么就会有50MB的碎片。

- 可变分区:动态分区方法，主存空间的分区是在作业转入时划分，正好划分为作业需要的大小，这样就不存在内部碎片，但容易将整片主存空间切割成许多块，会产生外部碎片（如进程需要内存分别是10MB、1MB、5MB，那么1MB回收之后，中间就会有1MB的碎片，并且可能因为太小无法得到分配）。

  > 系统分配可变分区算法有很多，假设现在需要分配9KB空间，对于不同的算法的结果介绍如下：
  >
  > ![image-20250324214722509](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324214722509.png)
  >
  > 循环首次适应法：找到作业3后，在放入作业4后，会从作业3接着往后找，只有到结尾，才会从头往下找。

- 可重定位分区:可以解决碎片问题，移动所有已经分配好的区域，使其成为个连续的区域，这样其他外部细小的分区碎片可以合并为大的分区，满足作业要求。只在外部作业请求空间得不到满足时进行。



#### 2.2 分页存储管理

##### 1.出现分页存储的原因（原理）

前面的分区存储管理，不管是静态（内存提前分配好）还是动态（进程来的时候分配），其都属于整存，即进程需要多少就给多少，但是当内存空间小于进程需要的空间的时候，即内存不够的时候，如果使用分区存储去进行整存的时候就无法进行存储了。所以，一般计算机中都采用分页存储管理或者分段存储管理，即不需要一次性将进程需要的空间全部分配过去，可以利用程序的局部性原理（即一个10GB的进程，不是一下子就需要使用10GB中的所有东西），一页一页往里面调，一条一条指令往下执行（下一个需要执行的指令，调入进来即可）

分页存储管理本身属于静态、固定的分配方法，因此会有碎片（最后一页中存在碎片，即程序的大小不是内存内存中页的整数倍），即如果内存有4GB，一页有4KB，那么会将进程也分为一个个页框/页帧，大小为4KB，当执行这个程序的时候，就按照执行顺序一页一页往内存中去调。

优点：利用率高，碎片小，分配及管理简单

缺点：增加系统开销，可能产生抖动现象（内存中有10页，外存中有20个页框，外存需要往内存中一个一个调，按道理来说内存中的页越多，往里面调的次数越少，但是如果算法选的不好，反而会增加往里面调的次数，即为抖动）

##### 2.组成

![image-20250324224733477](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324224733477.png)

逻辑页分为页号和页内地址，页内地址就是物理偏移地址，而页号与物理块号并非按序对应的，需要查询页表，才能得知页号对应的物理块号，再用物理块号加上偏移地址才得出了真正运行时的物理地址。

假设主存大小为4GB，每个页的大小为4KB，那么一共有2的20次页，即上述页号就占20位，有多少个页，就有多少个页号。页内地址和页的大小相关，即在页中的位置。



##### 3.逻辑地址（主存）和物理地址（外存）的转换

页内地址不变，因为页内地址就是页的大小，主存中页的大小和外存中页框的大小是一样的。逻辑地址中页号和物理地址中的块号（页号）需要根据页表去查询对应的映射关系。

![image-20250324225616663](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324225616663.png)

##### 4.页面置换算法

![image-20250324225731382](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324225731382.png)

##### 5.快表（快速页表）

是一块小容量的相联存储器，存储了慢表中访问最频繁的页号和物理块号的映射关系，由快速存储器组成，按内容访问，速度快，并且可以从硬件上保证按内容并行查找，一般用来存放当前访问最频繁的少数活动页面的页号。快表是将页表存于Cache中，慢表是将页表存于内存上。慢表需要访问两次内存才能取出页（第一次根据慢表获取映射关系，第二次去内存中获取数据），而快表是访问一次Cache和一次内存（一次Cache，通过快表找到对应关系，从内存中获取内容），因此更快。



##### 6.真题

![image-20250324230310255](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324230310255.png)

![image-20250324230324020](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250324230324020.png)



#### 2.3 分段存储管理

将进程空间分为一个个段，每段也有段号和段内地址，与页式存储不同的是，每段物理大小不同，分段是根据逻辑整体分段的（即分页的时候，可能每个页中不是一个完成的内容，如一个进程中，某一块是xxx地图，但是分页后，就不行了，而分段式将这整一块xxx地图进行划分，其大小不是固定的），因此，段表也与页表的内容不同，页表中直接是逻辑页号对应物理块号，而下图所示，段表有段长和基址两个属性，才能确定一个逻辑段在物理段中的位置。

![image-20250325224116266](image-20250325224116266.png)

![image-20250325224126427](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325224126427.png)

优点：多道程序共享内存，各段程序修改互不影响（每个段都保存程序自己的逻辑）。

缺点：内存利用率低，内存碎片浪费大。



真题：

![image-20250325224435411](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325224435411.png)



#### 2.4 段页式存储管理

先按照逻辑整体分成一个段，再在段中进行分页。

对进程空间先分段，后分页，具体原理图和优缺点如下，

优点:空间浪费小、存储共享容易、存储保护容易、能动态链接。

缺点:由于管理软件的增加，复杂性和开销也随之增加，需要的硬件以及占用的内容也有所增加，使得执行速度大大下降。

![image-20250325224628272](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325224628272.png)





### 3、设备管理

#### 3.1 设备管理概述

##### 1.该数

设备是计算机系统与外界交互的工具，具体负责计算机与外部的输入/输出工作，所以常称为外部设备(简称外设)。在计算机系统中，将负责管理设备和输入/输出的机构称为I/O系统。因此，I/O系统由设备、控制器、通道(具有通道的计算机系统)、总线和I/O 软件组成。

设备管理的任务是保证在多道程序环境下，当多个进程竞争使用设备时，按一定的策略分配和管理各种设备，控制设备的各种操作，完成I/O 设备与主存之间的数据交换。

设备管理的主要功能是动态地掌握并记录设备的状态、设备分配和释放、缓冲区管理、实现物理I/O设备的操作、提供设备使用的用户接口及设备的访问和控制。

##### 2. 设备分类

- 按数据组织分类:块设备、字符设备。
- 按照设备功能分类:输入设备、转输出设备、存储设备,网络联网设备、供电设备。
- 资源分配角度分类独占设备、共享设备和虚拟设备
- 数据传输速率分类低速设备、中速设备、高速设备。



#### 3.2 I/O软件

I/O设备管理软件的所有层次及每一层功能如下图:

实例:当用户程序试图读一个硬盘文件时，需要通过操作系统实现这一操作。与设备无关软件检查高速缓存中有无要读的数据块（有就直接返回即可），若没有，则调用设备驱动程序，向I/O 硬件发出一个请求。然后，用户进程阻塞并等待磁盘操作的完成（此时，计算机和外部设备已经建立了传输通道）。当磁盘操作完成时，硬件产生一个中断，转入中断处理程序。中断处理程序检查中断的原因，认识到这时磁盘读取操作已经完成，于是唤醒用户进程取回从磁盘读取的信息，从而结束此次I/O 请求。用户进程在得到了所需的硬盘文件内容之后继续运行。

![image-20250325225940200](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325225940200.png)

分层的目的就是隐藏IO操作实现的细节，将内部细节隐藏起来，方便用户使用IO设备

- 用户进程：和用户相关的，用户可以在这里进行输入输出的调用，如当要访问磁盘获取数据，就发出了一个IO调用
- 设备无关软件：和硬件无关
- 设备驱动程序：不同硬件有不同驱动程序
- 中断处理程序
- 硬件

#### 3.3 设备管理技术

一台独占设备，在同一时间只能由一个进程使用，其他进程只能等待，且不知道什么时候打印机空闲，此时，极大的浪费了外设的工作效率。引入SPOOLING(外围设备联机操作)技术，就是在外设上建立两个数据缓冲区，分别称为输入井和输出井，这样，无论多少进程，都可以共用这一台打印机，只需要将打印命令发出，数据就会排队存储在缓冲区中，打印机会自动按顺序打印，实现了物理外设的共享，使得每个进程都感觉在使用一个打印机，这就是物理设备的虚拟化。如下图所示:

![image-20250325231046626](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325231046626.png)

虚拟技术不是将一个打印机变成两个，可以同时打印，其还是按顺序进行打印，只不过其在提交打印的时候，不需要等待前面的打印结束。

每一个进程都感觉同时在使用这一资源，感觉是在并发、同时进行操作。（如A提交打印任务成功，B也提交任务成功，然后打印机将A和B都打印出来，从B宏观上看，是并发、同时进行打印的）





真题：

![image-20250325231259922](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250325231259922.png)



### 4、文件管理

#### 4.1 文件管理概述

##### 1.文件管理概述

文件是具有符号名的、在逻辑上具有完整意义的一组相关信息项的集合。（即我们在平时存在计算机文件夹中的东西，都是文件）

信息项是构成文件内容的基本单位，可以是一个字符，也可以是一个记录，记录可以等长，也可以不等长。一个文件包括文件体和文件说明。文件体是文件真实的内容。文件说明是操作系统为了管理文件所用到的信息，包括文件名、文件内部标识、文件的类型、文件存储地址、文件的长度、访问权限、建立时间和访问时间等。

文件管理系统，就是操作系统中实现文件统一管理的一组软件和相关数据的集合，专门负责管理和存取文件信息的软件机构，简称文件系统。文件系统的功能包括按名存取;统一的用户接口;并发访问和控制;安全性控制;优化性能;差错恢复。



##### 2.类型分类

- 按文件性质和用途可将文件分为系统文件、库文件和用户文件
- 按信息保存期限分类可将文件分为临时文件、档案文件和永久文件
- 按文件的保护方式分类可将文件分为只读文件、读/写文件、可执行文件和不保护文件。
- UNIX 系统将文件分为普通文件、目录文件和设备文件(特殊文件)



##### 3.文件结构

文件的逻辑结构（文件在逻辑上是如何存放的）可分为两大类:

- 有结构的记录式文件（按照记录存放，记录即一个完整逻辑整体）
- 无结构的流式文件（按照字符流、字节流存放）

文件的物理结构是指文件在物理存储设备上的存放方法：

- 连续结构。连续结构也称顺序结构，它将逻辑上连续的文件信息(如记录)依次存放在连续编号的物理块上（逻辑顺序和物理顺序对应）。
- 链接结构。链接结构也称串联结构，它是将逻辑上连续的文件信息(如记录)存放在不连续的物理块上，每个物理块设有一个指针指向下一个物理块。
- 索引结构。将逻辑上连续的文件信息(如记录)存放在不连续的物理块中系统为每个文件建立一张索引表。索引表记录了文件信息所在的逻辑块号对应的物理块号，并将索引表的起始地址放在与文件对应的文件目录项中
- 多个物理块的索引表。索引表是在文件创建时由系统自动建立的，并与文件一起存放在同一文件卷上。根据一个文件大小的不同，其索引表占用物理块的个数不等，一般占一个或几个物理块。



#### 4.2 索引文件结构

![image-20250326210226549](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326210226549.png)

索引文件结构目的：使用有限空间，表示更大的地址空间。

系统中有13个索引节点：

- 0-9为直接索引，即每个索引节点存放的是内容（一个物理盘大小），假设每个物理盘大小为4KB，共可存4KB*10=40KB数据;

- 10号索引节点为一级间接索引节点，大小为4KB，存放的并非直接数据，而是链接到直接物理盘块的地址，假设每个地址占4B，则共有1024个地址，对应1024个物理盘，可存`1024*4KB=4096KB`数据。
- 二级索引节点类似，直接盘存放一级地址，一级地址再存放物理盘快地址，而后链接到存放数据的物理盘块，容量又扩大了一个数量级，为`1024*1024*4KB`数据。



真题：

![image-20250326211832601](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326211832601.png)





#### 4.3 文件目录

![image-20250326212631136](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326212631136.png)

文件控制块中包含以下三类信息:基本信息类、存取控制信息类和使用信息类。文件控制块的有序集合称为文件目录。

(1)基本信息类。例如文件名、文件的物理地址、文件长度和文件块数等。

(2)存取控制信息类。文件的存取权限，像UNIX用户分成文件主、同组用户和一般用户三类，这三类用户的读/写执行RWX权限。

(3)使用信息类。文件建立日期、最后一次修改日期、最后一次访问的日期、当前使用的信息(如打开文件的进程数、在文件上的等待队列)等。

- 
  相对路径:是从当前路径开始的路径。
- 绝对路径:是从根目录开始的路径。
- 全文件名=绝对路径+文件名。要注意，绝对路径和相对路径是不加最后的文件名的，只是单纯的路径序列。



真题：

![image-20250326212904053](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326212904053.png)









#### 4.4 文件存储空间管理

##### 1.文件存取方式

文件的存取方法是指读/写文件存储器上的一个物理块的方法。通常顺序取和随机存取两种方法。顺序存取方法是指对文件中的信息按顺序依次进行读写;随机存取方法是指对文件中的信息可以按任意的次序随机地读/写。

##### 2.文件存储空间管理

- 空闲区表。将外存空间上的一个连续的未分配区域称为“空闲区”。操作系统为磁盘外存上的所有空闲区建立张空闲表，每个表项对应一个空闲区，适用于连续文件结构。

  如下，第18 19 20 21 22的块号为空

![image-20250326223155021](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326223155021.png)

- 位示图

位示图这种方法是在外存上建立一张位示图(Bitmap)记录文件存储的使用情况。每一位（一个bit位，二进制位）对应文件存储器上的一个物理块，取值0和1分别表示空闲和占用。位示图的大小 = 计算机中物理块数量 bit（即知道物理块数量即可知道位示图大小）

![image-20250326223603905](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326223603905.png)

- 空闲块链

每个空闲物理块中有指向下一个空闲物理块的指针，所有空闲物理块构成一个链表，链表的头指针放在文件存储器的特定位置上(如管理块中)，不需要磁盘分配表，节省空间。

- 成组链接法

例如，在实现时系统将空闲块分成若干组，每100个空闲块为一组，每组的第一个空闲块登记了下一组空闲块的物理盘块号和空闲块总数假如某个组的第一个空闲块号等于0，意味着该组是最后一组，无下一组空闲块



##### 3.真题：

![image-20250326223023572](%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20250326223023572.png)

