### 四、异常模块

## 一、概述

异常模块位于`org.apache.ibatis.exceptions`包下，相关内容如图所示：

![image-20250327163502305](%E5%9B%9B%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97.assets/image-20250327163502305.png)

在MyBatis中，不仅仅在exceptions包下有异常，其他包下也有异常，结构如下图所示：

![image-20250327163954430](%E5%9B%9B%E3%80%81%E5%BC%82%E5%B8%B8%E6%A8%A1%E5%9D%97.assets/image-20250327163954430.png)



## 二、相关内容

### 1、exceptions包下

#### 1.1 IbatisException

该类位于`org.apache.ibatis.exceptions`包下，IbatisException 已经在 2015 年被废弃，取代它的是 PersistenceException 类。

其实现RuntimeException类，是IBatis 的**异常基类**。相关源码如下所示：

```java
package org.apache.ibatis.exceptions;

/**
 * @author Clinton Begin
 */
@Deprecated
public class IbatisException extends RuntimeException {

    private static final long serialVersionUID = 3880206998166270511L;

    public IbatisException() {
    }

    public IbatisException(String message) {
        super(message);
    }

    public IbatisException(String message, Throwable cause) {
        super(message, cause);
    }

    public IbatisException(Throwable cause) {
        super(cause);
    }

}
```



#### 1.2 PersistenceException 

该类位于`org.apache.ibatis.exceptions`包下，其继承已经被弃用的IbatisException 类，其是Mybatis真正的异常积累，相关源码如下图所示：

```java
package org.apache.ibatis.exceptions;

/**
 * @author Clinton Begin
 */
@SuppressWarnings("deprecation")
public class PersistenceException extends IbatisException {

    private static final long serialVersionUID = -7537395265357977271L;

    public PersistenceException() {
    }

    public PersistenceException(String message) {
        super(message);
    }

    public PersistenceException(String message, Throwable cause) {
        super(message, cause);
    }

    public PersistenceException(Throwable cause) {
        super(cause);
    }
}

```



#### 1.3 ExceptionFactory

该类位于`org.apache.ibatis.exceptions`包下，是异常类的工厂对象，相关源码如下所示：

```java
package org.apache.ibatis.exceptions;

import org.apache.ibatis.executor.ErrorContext;

/**
 * @author Clinton Begin
 */
public class ExceptionFactory {

    // 空参构造器
    private ExceptionFactory() {
        // Prevent Instantiation
    }

    /**
   * 静态方法，创建PersistenceException对象
   * @param message 异常信息
   * @param e 异常类
   * @return PersistenceException对象
   */
    public static RuntimeException wrapException(String message, Exception e) {
        return new PersistenceException(ErrorContext.instance().message(message).cause(e).toString(), e);
    }

}

```



#### 1.4 TooManyResultsException

该类位于`org.apache.ibatis.exceptions`包下，其继承PersistenceException异常类，期望返回一条，实际返回了多条时抛出该异常，相关源码如下所示：

```java
/**
 * @author Clinton Begin
 */
public class TooManyResultsException extends PersistenceException {

    private static final long serialVersionUID = 8935197089745865786L;

    public TooManyResultsException() {
    }

    public TooManyResultsException(String message) {
        super(message);
    }

    public TooManyResultsException(String message, Throwable cause) {
        super(message, cause);
    }

    public TooManyResultsException(Throwable cause) {
        super(cause);
    }
}
```

### 2、其他异常类

其他包中也都会定义其**独有**的异常类，相关内容如下所示：

- `parsing`包：PersistenceException

  ```java
  package org.apache.ibatis.parsing;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class ParsingException extends PersistenceException {
      private static final long serialVersionUID = -176685891441325943L;
  
      public ParsingException() {
      }
  
      public ParsingException(String message) {
          super(message);
      }
  
      public ParsingException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public ParsingException(Throwable cause) {
          super(cause);
      }
  }
  ```

- `reflection` 包：ReflectionException

  ```java
  package org.apache.ibatis.reflection;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class ReflectionException extends PersistenceException {
  
      private static final long serialVersionUID = 7642570221267566591L;
  
      public ReflectionException() {
      }
  
      public ReflectionException(String message) {
          super(message);
      }
  
      public ReflectionException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public ReflectionException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

- `logging` 包：LogException

  ```java
  package org.apache.ibatis.logging;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class LogException extends PersistenceException {
  
      private static final long serialVersionUID = 1022924004852350942L;
  
      public LogException() {
      }
  
      public LogException(String message) {
          super(message);
      }
  
      public LogException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public LogException(Throwable cause) {
          super(cause);
      }
  
  }
  
  ```

- `builder` 包：BuilderException、IncompleteElementException

  ```java
  package org.apache.ibatis.builder;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class BuilderException extends PersistenceException {
  
      private static final long serialVersionUID = -3885164021020443281L;
  
      public BuilderException() {
      }
  
      public BuilderException(String message) {
          super(message);
      }
  
      public BuilderException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public BuilderException(Throwable cause) {
          super(cause);
      }
  }
  ```

  ```java
  package org.apache.ibatis.builder;
  
  /**
  * @author Eduardo Macarron
  */
  public class IncompleteElementException extends BuilderException {
      private static final long serialVersionUID = -3697292286890900315L;
  
      public IncompleteElementException() {
      }
  
      public IncompleteElementException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public IncompleteElementException(String message) {
          super(message);
      }
  
      public IncompleteElementException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

- `scripting` 包：ScriptingException

  ```java
  package org.apache.ibatis.scripting;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Frank D. Martinez [mnesarco]
   */
  public class ScriptingException extends PersistenceException {
  
      private static final long serialVersionUID = 7642570221267566591L;
  
      public ScriptingException() {
      }
  
      public ScriptingException(String message) {
          super(message);
      }
  
      public ScriptingException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public ScriptingException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

- `binding` 包：BindingException

  ```java
  package org.apache.ibatis.binding;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class BindingException extends PersistenceException {
  
      private static final long serialVersionUID = 4300802238789381562L;
  
      public BindingException() {
      }
  
      public BindingException(String message) {
          super(message);
      }
  
      public BindingException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public BindingException(Throwable cause) {
          super(cause);
      }
  }
  
  ```

- `type` 包：TypeException

  ```java
  package org.apache.ibatis.type;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class TypeException extends PersistenceException {
  
      private static final long serialVersionUID = 8614420898975117130L;
  
      public TypeException() {
      }
  
      public TypeException(String message) {
          super(message);
      }
  
      public TypeException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public TypeException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

- `session` 包：SqlSessionException

  ```java
  package org.apache.ibatis.session;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class SqlSessionException extends PersistenceException {
  
      private static final long serialVersionUID = 3833184690240265047L;
  
      public SqlSessionException() {
      }
  
      public SqlSessionException(String message) {
          super(message);
      }
  
      public SqlSessionException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public SqlSessionException(Throwable cause) {
          super(cause);
      }
  }
  
  ```

- `cache` 包：CacheException

  ```java
  package org.apache.ibatis.cache;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class CacheException extends PersistenceException {
  
      private static final long serialVersionUID = -193202262468464650L;
  
      public CacheException() {
      }
  
      public CacheException(String message) {
          super(message);
      }
  
      public CacheException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public CacheException(Throwable cause) {
          super(cause);
      }
  
  }
  
  ```

- `transaction` 包：TransactionException

  ```java
  package org.apache.ibatis.transaction;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class TransactionException extends PersistenceException {
  
      private static final long serialVersionUID = -433589569461084605L;
  
      public TransactionException() {
      }
  
      public TransactionException(String message) {
          super(message);
      }
  
      public TransactionException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public TransactionException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

  

- `datasource` 包：DataSourceException

  ```java
  package org.apache.ibatis.datasource;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class DataSourceException extends PersistenceException {
  
      private static final long serialVersionUID = -5251396250407091334L;
  
      public DataSourceException() {
      }
  
      public DataSourceException(String message) {
          super(message);
      }
  
      public DataSourceException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public DataSourceException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

  

- `executor` 包：ResultMapException、ExecutorException、BatchExecutorException

  ```java
  package org.apache.ibatis.executor.result;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Ryan Lamore
   */
  public class ResultMapException extends PersistenceException {
      private static final long serialVersionUID = 3270932060569707623L;
  
      public ResultMapException() {
      }
  
      public ResultMapException(String message) {
          super(message);
      }
  
      public ResultMapException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public ResultMapException(Throwable cause) {
          super(cause);
      }
  }
  
  ```

  ```java
  package org.apache.ibatis.executor;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class ExecutorException extends PersistenceException {
  
      private static final long serialVersionUID = 4060977051977364820L;
  
      public ExecutorException() {
      }
  
      public ExecutorException(String message) {
          super(message);
      }
  
      public ExecutorException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public ExecutorException(Throwable cause) {
          super(cause);
      }
  
  }
  ```

  ```java
  package org.apache.ibatis.executor;
  
  import java.sql.BatchUpdateException;
  import java.util.List;
  
  /**
   * This exception is thrown if a <code>java.sql.BatchUpdateException</code> is caught during the execution of any nested
   * batch. The exception contains the java.sql.BatchUpdateException that is the root cause, as well as the results from
   * any prior nested batch that executed successfully.
   *
   * @author Jeff Butler
   */
  public class BatchExecutorException extends ExecutorException {
  
      private static final long serialVersionUID = 154049229650533990L;
      private final List<BatchResult> successfulBatchResults;
      private final BatchUpdateException batchUpdateException;
      private final BatchResult batchResult;
  
      public BatchExecutorException(String message, BatchUpdateException cause, List<BatchResult> successfulBatchResults,
                                    BatchResult batchResult) {
          super(message + " Cause: " + cause, cause);
          this.batchUpdateException = cause;
          this.successfulBatchResults = successfulBatchResults;
          this.batchResult = batchResult;
      }
  
      /**
     * Returns the BatchUpdateException that caused the nested executor to fail. That exception contains an array of row
     * counts that can be used to determine exactly which statement of the executor caused the failure (or failures).
     *
     * @return the root BatchUpdateException
     */
      public BatchUpdateException getBatchUpdateException() {
          return batchUpdateException;
      }
  
      /**
     * Returns a list of BatchResult objects. There will be one entry in the list for each successful sub-executor
     * executed before the failing executor.
     *
     * @return the previously successful executor results (maybe an empty list if no executor has executed successfully)
     */
      public List<BatchResult> getSuccessfulBatchResults() {
          return successfulBatchResults;
      }
  
      /**
     * Returns the SQL statement that caused the failure (not the parameterArray).
     *
     * @return the failing SQL string
     */
      public String getFailingSqlStatement() {
          return batchResult.getSql();
      }
  
      /**
     * Returns the statement id of the statement that caused the failure.
     *
     * @return the statement id
     */
      public String getFailingStatementId() {
          return batchResult.getMappedStatement().getId();
      }
  }
  ```

  

- `plugin` 包：PluginException

  ```java
  package org.apache.ibatis.plugin;
  
  import org.apache.ibatis.exceptions.PersistenceException;
  
  /**
   * @author Clinton Begin
   */
  public class PluginException extends PersistenceException {
  
      private static final long serialVersionUID = 8548771664564998595L;
  
      public PluginException() {
      }
  
      public PluginException(String message) {
          super(message);
      }
  
      public PluginException(String message, Throwable cause) {
          super(message, cause);
      }
  
      public PluginException(Throwable cause) {
          super(cause);
      }
  }
  ```

  

